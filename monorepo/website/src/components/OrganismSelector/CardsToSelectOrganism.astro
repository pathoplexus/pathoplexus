---
import { getConfiguredOrganisms } from '../../config';
import { formatNumberWithDefaultLocale } from '../../utils/formatNumber';

interface Props {
    getLinkForOrganism: (organismKey: string) => string;
    instructionText: string;
    organismStatisticsMap?: Map<string, { totalSequences: number; recentSequences: number }>;
    numberDaysAgoStatistics?: number;
}

const { getLinkForOrganism, instructionText, organismStatisticsMap, numberDaysAgoStatistics } = Astro.props;

const configuredOrganisms = getConfiguredOrganisms();
---

<section class='pt-2'>
    <div class='mb-5 px-1'>
        <h2 class='text-base font-medium text-slate-800 sm:text-lg'>
            {instructionText}
        </h2>
    </div>
    <div class='grid grid-cols-1 gap-6 md:grid-cols-2 lg:grid-cols-3'>
        {
            configuredOrganisms.map(({ key, displayName, image }) => {
                const stats = organismStatisticsMap?.get(key);
                return (
                    <a
                        href={getLinkForOrganism(key)}
                        class='group block rounded-2xl border border-base-200/70 bg-base-100 p-6 transition-colors duration-150 hover:shadow-[0_4px_12px_rgba(0,0,0,0.08)] focus:outline-none focus-visible:ring-2 focus-visible:ring-primary/40 no-underline hover:no-underline'
                    >
                        <div class='flex items-start justify-between gap-4'>
                            <div class='flex min-w-0 items-start gap-4'>
                                {image && (
                                    <img
                                        src={image}
                                        alt={displayName}
                                        class='h-14 w-14 rounded-full object-cover ring-2 ring-primary/20 transition-colors group-hover:ring-primary/30'
                                    />
                                )}
                                <div>
                                    <h3 class='pr-2 text-lg font-medium leading-6 text-slate-900'>{displayName}</h3>
                                    {organismStatisticsMap && (
                                        <p class='mt-2 text-sm text-slate-600'>
                                            {stats
                                                ? `${formatNumberWithDefaultLocale(stats.totalSequences)} total sequences`
                                                : 'Sequence counts coming soon'}
                                        </p>
                                    )}
                                </div>
                            </div>
                            <div class='flex-shrink-0 text-xl text-primary/70 transition-all duration-150 group-hover:translate-x-0.5 group-hover:text-primary/80'>
                                â†’
                            </div>
                        </div>
                        {stats && numberDaysAgoStatistics && (
                            <div class='mt-4 text-xs text-slate-500'>
                                +{formatNumberWithDefaultLocale(stats.recentSequences)} in last{' '}
                                {numberDaysAgoStatistics} days
                            </div>
                        )}
                    </a>
                );
            })
        }
    </div>
</section>
