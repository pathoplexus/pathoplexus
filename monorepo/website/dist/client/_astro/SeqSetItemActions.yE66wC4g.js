import{j as e}from"./jsx-runtime.C9E4cUVc.js";import{r as f}from"./index.BOC3FD3Q.js";import{y as N}from"./_astro-entry_react-toastify.w1t6keWD.js";import{s as S,S as E}from"./SeqSetForm.B0m1l9G0.js";import{g as M}from"./clientLogger.CHIvnBnE.js";import{s as V}from"./serviceHooks.qDjWrls6.js";import{c as F}from"./createAuthorizationHeader.D0lXW5f5.js";import{d as T}from"./ConfirmationDialog.DES7BW3S.js";import{D as y}from"./DisabledUntilHydrated.BWqRU456.js";import{B as k}from"./Modal.4Z0q6RJX.js";import{w as L}from"./withQueryProvider.C5jGp74p.js";import"./clsx.B-dksMZM.js";import"./index.D4-OCOkl.js";import"./routes.B4evqrXf.js";import"./SubmissionRoute.C0UznQB_.js";import"./lapis.BMBLPoxt.js";import"./index.B4z6aONy.js";import"./client.DPyJZckk.js";import"./index.BDobkqVR.js";import"./isClient.CwQyaCl4.js";import"./useTheme.DwRJctbP.js";import"./utils.CJHPicf9.js";import"./index.CExoqQxK.js";const B=({seqSet:t,seqSetRecords:s,databaseName:r})=>{const[a,l]=f.useState(!1),[o,d]=f.useState(0),[i,u]=f.useState(0),m=n=>new Date(n).getFullYear(),x=()=>t.seqSetDOI===null||t.seqSetDOI===void 0?window.location.href:`https://doi.org/${t.seqSetDOI}`,b=()=>{const c="data:text/json;charset=utf-8,"+encodeURIComponent(JSON.stringify({seqSet:t,sequences:s})),g=document.createElement("a");g.href=c,g.download=`${t.name}.json`,g.click()},h=()=>{const n=[...Object.keys(t),"focalAccessions","backgroundAccessions"],c=Object.values(t).join("	"),g=S(s,!0),I=S(s,!1),O=[n.join("	"),c+"	"+g+"	"+I].join(`\r
`),q="data:text/tsv;charset=utf-8,"+encodeURIComponent(O),p=document.createElement("a");p.href=q,p.download=`${t.name}.tsv`,p.click()},v=()=>{l(!0),o===0?b():o===1&&h(),l(!1)},C=()=>{const n=(t.seqSetDOI??`${t.seqSetId}.${t.seqSetVersion}`).replace(/[^\w]/g,"_"),c=[`title = {SeqSet: ${t.name}}`,`journal = {${r}}`,`year = {${m(t.createdAt)}}`,`url = {${x()}}`];return t.seqSetDOI!==null&&t.seqSetDOI!==void 0&&c.push(`doi = {${t.seqSetDOI}}`),`@dataset{${n},
	${c.join(`,
	`)}
}`},D=()=>`SeqSet: ${t.name}. ${r}, ${m(t.createdAt)}. ${x()}`,$=()=>`SeqSet: ${t.name}. (${m(t.createdAt)}). ${r}. ${x()}`,j=()=>i===0?C():i===1?D():$(),A=async()=>{const n=j();await navigator.clipboard.writeText(n),N.success("Copied to clipboard",{position:"bottom-center",autoClose:2e3})};return e.jsxs("div",{className:"flex flex-col flex-start items-center w-full",children:[e.jsx("div",{className:"flex justify-start items-center py-5",children:e.jsx("h1",{className:"text-xl font-semibold",children:"Export"})}),e.jsxs("div",{className:"flex flex-col justify-around max-w-lg w-2/4",children:[e.jsxs("div",{children:[e.jsxs("div",{className:"flex",children:[e.jsxs("div",{className:"flex items-center me-4",children:[e.jsx("input",{id:"json-radio","data-testid":"json-radio",checked:o===0,type:"radio",className:"w-4 h-4 text-blue-600 bg-gray-100 border-gray-300 focus:ring-blue-500 dark:focus:ring-blue-600 dark:ring-offset-gray-800 focus:ring-2 dark:bg-gray-700 dark:border-gray-600",onChange:()=>d(0)}),e.jsx("label",{htmlFor:"json-radio",className:"ms-2 text-sm font-medium text-gray-900 dark:text-gray-300",children:"JSON"})]}),e.jsxs("div",{className:"flex items-center me-4",children:[e.jsx("input",{id:"tsv-radio","data-testid":"tsv-radio",type:"radio",checked:o===1,className:"w-4 h-4 text-blue-600 bg-gray-100 border-gray-300 focus:ring-blue-500 dark:focus:ring-blue-600 dark:ring-offset-gray-800 focus:ring-2 dark:bg-gray-700 dark:border-gray-600",onChange:()=>d(1)}),e.jsx("label",{htmlFor:"tsv-radio",className:"ms-2 text-sm font-medium text-gray-900 dark:text-gray-300",children:"TSV"})]})]}),e.jsx("div",{className:"pb-8 pt-4",children:e.jsx("button",{className:"btn",onClick:v,disabled:a,children:"Download"})})]}),e.jsx("hr",{className:"mb-8"}),e.jsxs("div",{className:"flex",children:[e.jsxs("div",{className:"flex items-center me-4",children:[e.jsx("input",{id:"bibtex-radio",checked:i===0,type:"radio",name:"inline-radio-group",className:"w-4 h-4 text-blue-600 bg-gray-100 border-gray-300 focus:ring-blue-500 dark:focus:ring-blue-600 dark:ring-offset-gray-800 focus:ring-2 dark:bg-gray-700 dark:border-gray-600",onChange:()=>u(0)}),e.jsx("label",{htmlFor:"bibtex-radio",className:"ms-2 text-sm font-medium text-gray-900 dark:text-gray-300",children:"BibTeX"})]}),e.jsxs("div",{className:"flex items-center me-4",children:[e.jsx("input",{id:"mla-radio",type:"radio",checked:i===1,name:"inline-radio-group",className:"w-4 h-4 text-blue-600 bg-gray-100 border-gray-300 focus:ring-blue-500 dark:focus:ring-blue-600 dark:ring-offset-gray-800 focus:ring-2 dark:bg-gray-700 dark:border-gray-600",onChange:()=>u(1)}),e.jsx("label",{htmlFor:"mla-radio",className:"ms-2 text-sm font-medium text-gray-900 dark:text-gray-300",children:"MLA"})]}),e.jsxs("div",{className:"flex items-center me-4",children:[e.jsx("input",{id:"apa-radio",type:"radio",checked:i===2,name:"inline-radio-group",className:"w-4 h-4 text-blue-600 bg-gray-100 border-gray-300 focus:ring-blue-500 dark:focus:ring-blue-600 dark:ring-offset-gray-800 focus:ring-2 dark:bg-gray-700 dark:border-gray-600",onChange:()=>u(2)}),e.jsx("label",{htmlFor:"apa-radio",className:"ms-2 text-sm font-medium text-gray-900 dark:text-gray-300",children:"APA"})]})]}),e.jsx("div",{className:"py-4 w-full",children:e.jsx("textarea",{id:"citation-text",className:"block w-full p-4 text-gray-900 border border-gray-300 rounded-lg bg-gray-50 text-base focus:ring-blue-500 focus:border-blue-500 dark:bg-gray-700 dark:border-gray-600 dark:placeholder-gray-400 dark:text-white dark:focus:ring-blue-500 dark:focus:border-blue-500",rows:5,cols:40,value:j(),readOnly:!0})}),e.jsx("div",{className:"pb-8",children:e.jsx("button",{className:"btn",onClick:()=>void A(),disabled:a,children:"Copy to clipboard"})})]})]})},w=M("SeqSetItemActions"),J=({clientConfig:t,accessToken:s,seqSet:r,seqSetRecords:a,isAdminView:l=!1,databaseName:o})=>{const[d,i]=f.useState(!1),[u,m]=f.useState(!1),{mutate:x}=U(t,s,r.seqSetId,r.seqSetVersion,h=>N.error(h,{position:"top-center",autoClose:!1})),b=()=>{x(void 0)};return e.jsxs("div",{className:"flex flex-col items-left",children:[e.jsx("div",{className:"flex-row items-center justify-between w-full",children:e.jsxs("div",{className:"flex justify-start items-center pt-4 pb-8",children:[e.jsx("div",{className:"pr-2",children:e.jsx(y,{children:e.jsx("button",{className:"btn",onClick:()=>m(!0),children:"Export"})})}),e.jsx("div",{className:"px-2",children:l?e.jsx(y,{children:e.jsx("button",{className:"btn",onClick:()=>i(!0),children:"Edit"})}):null}),e.jsx("div",{className:"px-2",children:l&&(r.seqSetDOI===null||r.seqSetDOI===void 0)?e.jsx(y,{children:e.jsx("button",{className:"btn",onClick:()=>T({dialogText:"Are you sure you want to delete this seqSet version?",onConfirmation:b}),children:"Delete"})}):null})]})}),e.jsx(k,{isModalVisible:d,setModalVisible:i,children:e.jsx(E,{clientConfig:t,accessToken:s,editSeqSet:r,editSeqSetRecords:a})}),e.jsx(k,{isModalVisible:u,setModalVisible:m,children:e.jsx(B,{seqSet:r,seqSetRecords:a,databaseName:o})})]})};function U(t,s,r,a,l){return V(t).useDeleteSeqSet({headers:F(s),params:{seqSetId:r,seqSetVersion:a}},{onSuccess:async()=>{await w.info(`Successfully deleted seqSet with seqSetId: ${r}, version ${a}`),window.location.href="/seqsets"},onError:async o=>{const d=`Failed to delete seqSet with error: '${JSON.stringify(o)})}'`;await w.info(d),l(d)}})}const me=L(J);export{me as SeqSetItemActions};
