import{j as e}from"./jsx-runtime.C9E4cUVc.js";import{c as q,A as y}from"./createAuthorizationHeader.D0lXW5f5.js";import{c as z}from"./index.D4-OCOkl.js";import{r as u}from"./index.BOC3FD3Q.js";import{y as H}from"./_astro-entry_react-toastify.w1t6keWD.js";import{g as J}from"./clientLogger.CHIvnBnE.js";import{r as O}from"./routes.B4evqrXf.js";import{S as T,s as U}from"./serviceHooks.qDjWrls6.js";const b=(l,c,i=T.loculus,n=/[,\s]/)=>l.split(n).map(a=>a.trim()).filter(Boolean).map(a=>({accession:a,type:i,isFocal:c})),j=(l,c=!0,i=",")=>{if(!l||l.length===0)return"";const n=l.filter(a=>a.isFocal===c);return n.length===0?"":n.map(a=>a.accession).join(`${i} `)},g=J("SeqSetForm"),Y=({clientConfig:l,accessToken:c,editSeqSet:i,editSeqSetRecords:n})=>{const[a,S]=u.useState(i?.name??""),[m,p]=u.useState(""),[t,r]=u.useState(i?.description??""),[d,$]=u.useState(j(n,!0)),[f,I]=u.useState(j(n,!1)),[x,h]=u.useState(""),{createSeqSet:A,updateSeqSet:C,validateSeqSetRecords:k,isLoading:v}=B(l,c,s=>H.error(s,{position:"top-center",autoClose:!1}),h);u.useEffect(()=>{const s=setTimeout(()=>{const o=[...b(d,!0),...b(f,!1)];if(o.length===0){h("");return}k(o)},1e3);return()=>clearTimeout(s)},[d,f,k]);const F=(s,o)=>{o?$(s):I(s)},E=()=>({name:a,description:t,records:[...b(d,!0),...b(f,!1)]}),R=s=>{s.preventDefault();const o=E();if(o.name===""){p("SeqSet name is required");return}if(d===""&&f===""){h("At least one Loculus accession is required");return}i!==void 0?C({seqSetId:i.seqSetId,...o}):A(o)},L=(s="")=>s===""?"block w-full p-4 text-gray-900 border border-gray-300 rounded-lg bg-gray-50 text-base focus:ring-blue-500 focus:border-blue-500 dark:bg-gray-700 dark:border-gray-600 dark:placeholder-gray-400 dark:text-white dark:focus:ring-blue-500 dark:focus:border-blue-500":"block w-full p-4 text-gray-900 border border-red-300 rounded-lg bg-gray-50 text-base focus:ring-red-500 focus:border-red-500 dark:bg-gray-700 dark:border-red-600 dark:placeholder-gray-400 dark:text-white dark:focus:ring-red-500 dark:focus:border-red-500",w=(s="")=>s===""?"bg-gray-50 border border-gray-300 text-gray-900 text-sm rounded-lg focus:ring-blue-500 focus:border-blue-500 block w-full p-2.5 dark:bg-gray-700 dark:border-gray-600 dark:placeholder-gray-400 dark:text-white dark:focus:ring-blue-500 dark:focus:border-blue-500":"bg-gray-50 border border-red-300 text-gray-900 text-sm rounded-lg focus:ring-red-500 focus:border-red-500 block w-full p-2.5 dark:bg-gray-700 dark:border-red-600 dark:placeholder-gray-400 dark:text-white dark:focus:ring-red-500 dark:focus:border-red-500",N=s=>{const o=s?"focal":"background",D=s?d:f;return e.jsx("div",{children:e.jsxs("div",{className:"mb-6",children:[e.jsx("label",{htmlFor:`loculus-${o}-accession-input`,className:"block mb-2 text-sm font-medium text-gray-900 dark:text-white",children:`${s?"* ":""}${z(o)} accessions (separated by comma or whitespace)`}),e.jsx("textarea",{id:`loculus-${o}-accession-input`,className:L(x),value:D,onChange:V=>{F(V.target.value,s)},rows:4,cols:40})]},`loculus-${o}-input`)})};return e.jsxs("div",{className:"flex flex-col items-center  overflow-auto-y w-full",children:[e.jsx("div",{className:"flex justify-start items-center py-5",children:e.jsx("h1",{className:"text-xl font-semibold py-4",children:`${i?"Edit":"Create a"} SeqSet`})}),e.jsxs("div",{className:"max-w-lg w-full",children:[e.jsxs("div",{children:[e.jsx("label",{htmlFor:"seqSet-name",className:"block mb-2 text-sm font-medium text-gray-900 dark:text-white",children:"* SeqSet name"}),e.jsx("input",{type:"text",id:"seqSet-name",className:w(m),value:a,onChange:s=>{S(s.target.value),p("")},maxLength:255,required:!0}),e.jsx("div",{className:"pb-6 max-w-md w-full",children:e.jsx("p",{className:"text-red-500 text-sm italic",children:m})})]}),e.jsxs("div",{className:"mb-6",children:[e.jsx("label",{htmlFor:"seqSet-description",className:"block mb-2 text-sm font-medium text-gray-900 dark:text-white",children:"SeqSet description"}),e.jsx("input",{type:"text",id:"seqSet-description",className:w(),value:t,onChange:s=>{r(s.target.value)},maxLength:255})]}),e.jsx("h1",{className:"text-lg font-semibold py-4",children:"Accessions"}),N(!0),N(!1),e.jsx("div",{className:"max-w-md w-full",children:x!==""?e.jsx("p",{className:"pb-4 text-red-500 text-sm italic",children:x}):null}),e.jsx("div",{className:"pb-4",children:e.jsxs("span",{className:"label-text",children:["Review",e.jsx("a",{href:O.datauseTermsPage(),target:"_blank",className:"underline ml-1",children:"data use terms"}),"."]})})]}),e.jsx("button",{className:"flex items-center btn loculusColor text-white hover:bg-primary-700",disabled:v||x!==""||m!=="",onClick:R,children:v?e.jsx("span",{className:"loading loading-spinner loading-sm mr-2 relative top-1"}):"Save"})]})};function B(l,c,i,n){const a=U(l),S=a.useCreateSeqSet({headers:q(c)},{onSuccess:async t=>{await g.info(`Successfully created seqSet with seqSetId: ${t.seqSetId}`);const r=`/seqsets/${t.seqSetId}.${t.seqSetVersion}`;location.href=r},onError:async t=>{if(await g.info(`Failed to create seqSet. Error: '${JSON.stringify(t)})}'`),t instanceof y){const r=t.response?.data;r!==void 0&&i(`Failed to create seqSet. ${r.title}. ${r.detail}`)}}}),m=a.useUpdateSeqSet({headers:q(c)},{onSuccess:async t=>{await g.info(`Successfully updated seqSet with seqSetId: ${t.seqSetId}`);const r=`/seqsets/${t.seqSetId}.${t.seqSetVersion}`;location.href=r},onError:async t=>{if(await g.info(`Failed to update seqSet. Error: '${JSON.stringify(t)})}'`),t instanceof y){const r=t.response?.data;r!==void 0&&i(`Failed to update seqSet. ${r.title}. ${r.detail}`)}}}),p=a.useValidateSeqSetRecords({headers:q(c)},{onSuccess:()=>{n("")},onError:async t=>{if(await g.info(`Failed to validate seqSet records. Error: '${JSON.stringify(t)})}'`),t instanceof y&&t.response?.data!==void 0){const r=t.response.data,d=`${r.title}. ${r.detail}`;n(d)}}});return{createSeqSet:S.mutate,updateSeqSet:m.mutate,validateSeqSetRecords:p.mutate,isLoading:S.isLoading||m.isLoading}}export{Y as S,j as s};
