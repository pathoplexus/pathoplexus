import{j as e}from"./jsx-runtime.C9E4cUVc.js";import{r as p}from"./index.BOC3FD3Q.js";import{y as fe}from"./_astro-entry_react-toastify.w1t6keWD.js";import{J as R,K as y,L as D,M as F,N as P,O as X,P as T,Q as E,R as ee,S as je}from"./lapis.BMBLPoxt.js";import{B as ve,a as we,b as be,F as Ne,r as ye,I as Ce,g as Re,E as se}from"./BoxWithTabs.DWe_-5ZS.js";import{b as ae,a as K}from"./serviceHooks.qDjWrls6.js";import{C as j,g as Fe}from"./CustomTooltip.yAYB-6k6.js";import{c as V,e as Y}from"./createAuthorizationHeader.D0lXW5f5.js";import{g as C,r as te}from"./routes.B4evqrXf.js";import{F as Pe,b as Ae}from"./unlocked.BhwIO2z4.js";import{s as J}from"./stringifyMaybeAxiosError.Dyiug7p6.js";import"./runtimeConfig.CVbULwPe.js";import{d as S}from"./ConfirmationDialog.DES7BW3S.js";import{w as Ie}from"./withQueryProvider.C5jGp74p.js";import{F as Me}from"./arrow-down.B8IS15yr.js";import{P as ke}from"./Pagination.BSeKhfNm.js";import"./clsx.B-dksMZM.js";import"./open-closed.CJcKiZsm.js";import"./index.CExoqQxK.js";import"./index.BDobkqVR.js";import"./index.B7uol7Hd.js";import"./react-tooltip.min.CEnrnmjl.js";import"./SubmissionRoute.C0UznQB_.js";import"./index.B4z6aONy.js";import"./client.DPyJZckk.js";import"./useTheme.DwRJctbP.js";import"./ButtonBase.BnBxMrJ6.js";const Se=({isOpen:s,onClose:t,dataToView:i})=>!s||!i?null:e.jsx("div",{className:"fixed inset-0 flex items-center justify-center z-50 overflow-auto bg-black bg-opacity-30",children:e.jsxs("div",{className:"bg-white rounded-lg p-6 max-w-xl mx-3 w-full max-h-[90vh] flex flex-col",children:[e.jsxs("div",{className:"flex justify-between items-center mb-4",children:[e.jsx("h2",{className:"text-xl font-semibold",children:"Files"}),e.jsx("button",{className:"text-gray-500 hover:text-gray-700",onClick:t,children:"✕"})]}),e.jsx("div",{children:Object.entries(i.processedData.files??{}).map(([o,r])=>e.jsxs("div",{className:"mb-4",children:[e.jsx("h3",{className:"font-medium",children:o}),e.jsx("ul",{className:"list-disc pl-5 space-y-1",children:r.map(a=>e.jsx("li",{children:e.jsx("a",{href:`/seq/${i.accession}.${i.version}/${o}/${a.name}`,className:"text-primary-600 hover:underline",children:a.name})},a.fileId))})]},o))})]})}),De=({isOpen:s,onClose:t,dataToView:i})=>{const[o,r]=p.useState(0);if(!s||!i)return null;const a=ze(i);return a.length===0?null:e.jsx("div",{className:"fixed inset-0 flex items-center justify-center z-50 overflow-auto bg-black bg-opacity-30",children:e.jsxs("div",{className:"bg-white rounded-lg p-6 max-w-6xl mx-3 w-full max-h-[90vh] flex flex-col",children:[e.jsxs("div",{className:"flex justify-between items-center mb-4",children:[e.jsx("h2",{className:"text-xl font-semibold",children:"Processed sequences"}),e.jsx("button",{className:"text-gray-500 hover:text-gray-700",onClick:t,children:"✕"})]}),e.jsxs("div",{className:"flex-grow overflow-hidden flex flex-col",children:[e.jsx(ve,{children:a.map(({label:l},d)=>e.jsx(we,{isActive:d===o,label:l,onClick:()=>r(d)},l))}),e.jsx(be,{children:a[o].sequence!==null&&e.jsx("div",{className:"overflow-auto",style:{maxHeight:"calc(80vh - 10rem)"},children:e.jsx(Ne,{text:a[o].sequence,maxLineLength:100})})})]})]})})},ze=s=>[{type:"unaligned",sequences:s.processedData.unalignedNucleotideSequences},{type:"aligned",sequences:s.processedData.alignedNucleotideSequences},{type:"gene",sequences:s.processedData.alignedAminoAcidSequences}].flatMap(({type:t,sequences:i})=>Object.entries(i).map(([o,r])=>{let a=o;return t!=="gene"&&(a==="main"?a=t==="unaligned"?"Sequence":"Aligned":a=t==="unaligned"?`${o} (unaligned)`:`${o} (aligned)`),{label:a,sequence:r}})),Le=s=>s===null?"null":typeof s=="number"&&Number.isInteger(s)?s.toString():typeof s=="number"?s.toFixed(2):s.toString(),qe=(s,t)=>e.jsx("svg",{viewBox:"0 0 16 16",width:"1.2em",height:"1.2em",ref:t,...s,children:e.jsxs("g",{fill:"currentColor",children:[e.jsx("path",{d:"M5.5 5.5A.5.5 0 0 1 6 6v6a.5.5 0 0 1-1 0V6a.5.5 0 0 1 .5-.5m2.5 0a.5.5 0 0 1 .5.5v6a.5.5 0 0 1-1 0V6a.5.5 0 0 1 .5-.5m3 .5a.5.5 0 0 0-1 0v6a.5.5 0 0 0 1 0z"}),e.jsx("path",{d:"M14.5 3a1 1 0 0 1-1 1H13v9a2 2 0 0 1-2 2H5a2 2 0 0 1-2-2V4h-.5a1 1 0 0 1-1-1V2a1 1 0 0 1 1-1H6a1 1 0 0 1 1-1h2a1 1 0 0 1 1 1h3.5a1 1 0 0 1 1 1zM4.118 4L4 4.059V13a1 1 0 0 0 1 1h6a1 1 0 0 0 1-1V4.059L11.882 4zM2.5 3h11V2h-11z"})]})}),$=p.forwardRef(qe),Te=(s,t)=>e.jsxs("svg",{viewBox:"0 0 36 36",width:"1.2em",height:"1.2em",ref:t,...s,children:[e.jsx("path",{fill:"currentColor",d:"M28 30H6V8h13.22l2-2H6a2 2 0 0 0-2 2v22a2 2 0 0 0 2 2h22a2 2 0 0 0 2-2V15l-2 2Z",className:"clr-i-outline clr-i-outline-path-1"}),e.jsx("path",{fill:"currentColor",d:"m33.53 5.84l-3.37-3.37a1.61 1.61 0 0 0-2.28 0L14.17 16.26l-1.11 4.81A1.61 1.61 0 0 0 14.63 23a1.7 1.7 0 0 0 .37 0l4.85-1.07L33.53 8.12a1.61 1.61 0 0 0 0-2.28M18.81 20.08l-3.66.81l.85-3.63L26.32 6.87l2.82 2.82ZM30.27 8.56l-2.82-2.82L29 4.16L31.84 7Z",className:"clr-i-outline clr-i-outline-path-2"}),e.jsx("path",{fill:"none",d:"M0 0h36v36H0z"})]}),Ve=p.forwardRef(Te),$e=(s,t)=>e.jsx("svg",{viewBox:"0 0 24 24",width:"1.2em",height:"1.2em",ref:t,...s,children:e.jsx("path",{fill:"currentColor",d:"M17.75 3A3.25 3.25 0 0 1 21 6.25V13h-4.75A3.25 3.25 0 0 0 13 16.25V21H6.25A3.25 3.25 0 0 1 3 17.75V6.25A3.25 3.25 0 0 1 6.25 3zm2.81 11.5l-6.06 6.06v-4.31c0-.966.784-1.75 1.75-1.75z"})}),Be=p.forwardRef($e),Oe=(s,t)=>e.jsx("svg",{viewBox:"0 0 24 24",width:"1.2em",height:"1.2em",ref:t,...s,children:e.jsx("path",{fill:"currentColor",d:"M19.75 2A2.25 2.25 0 0 1 22 4.25v5.462a3.25 3.25 0 0 1-.952 2.298l-.026.026a6.5 6.5 0 0 0-9.028 8.92a3.256 3.256 0 0 1-4.043-.442L3.489 16.06a3.25 3.25 0 0 1-.004-4.596l8.5-8.51a3.25 3.25 0 0 1 2.3-.953zM17 5.502a1.5 1.5 0 1 0 0 3a1.5 1.5 0 0 0 0-3M23 17.5a5.5 5.5 0 1 0-11 0a5.5 5.5 0 0 0 11 0m-6.125 3.005a.625.625 0 1 1 1.25 0a.625.625 0 0 1-1.25 0m-1.229-4.548c-.01-1.137.806-1.954 1.854-1.954c1.03 0 1.853.846 1.853 1.95c0 .566-.185.913-.663 1.447l-.266.29l-.1.116c-.248.292-.324.462-.324.695a.5.5 0 0 1-1 0c0-.576.187-.926.67-1.468l.266-.29l.1-.113c.242-.286.317-.453.317-.677c0-.558-.38-.95-.853-.95c-.494 0-.86.366-.854.945a.5.5 0 0 1-1 .01"})}),He=p.forwardRef(Oe),We=(s,t)=>e.jsx("svg",{viewBox:"0 0 24 24",width:"1.2em",height:"1.2em",ref:t,...s,children:e.jsx("path",{fill:"none",stroke:"currentColor",strokeWidth:2,d:"M12 22c5.523 0 10-4.477 10-10S17.523 2 12 2S2 6.477 2 12s4.477 10 10 10Zm0-6a4 4 0 1 0 0-8a4 4 0 0 0 0 8Z"})}),Qe=p.forwardRef(We),Ue=(s,t)=>e.jsx("svg",{viewBox:"0 0 24 24",width:"1.2em",height:"1.2em",ref:t,...s,children:e.jsxs("g",{fill:"none",stroke:"currentColor",strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,children:[e.jsx("path",{d:"M15 2a2 2 0 0 1 1.414.586l4 4A2 2 0 0 1 21 8v7a2 2 0 0 1-2 2h-8a2 2 0 0 1-2-2V4a2 2 0 0 1 2-2z"}),e.jsx("path",{d:"M15 2v4a2 2 0 0 0 2 2h4M5 7a2 2 0 0 0-2 2v11a2 2 0 0 0 2 2h8a2 2 0 0 0 1.732-1"})]})}),Ge=p.forwardRef(Ue),Ze=(s,t)=>e.jsx("svg",{viewBox:"0 0 24 24",width:"1.2em",height:"1.2em",ref:t,...s,children:e.jsx("path",{fill:"currentColor",d:"M4 2h2v2c0 1.44.68 2.61 1.88 3.78c.86.83 2.01 1.63 3.21 2.42l-1.83 1.19C8.27 10.72 7.31 10 6.5 9.21C5.07 7.82 4 6.1 4 4zm14 0h2v2c0 2.1-1.07 3.82-2.5 5.21c-1.41 1.38-3.21 2.52-4.96 3.63c-1.75 1.12-3.45 2.21-4.66 3.38C6.68 17.39 6 18.56 6 20v2H4v-2c0-2.1 1.07-3.82 2.5-5.21c1.41-1.38 3.21-2.52 4.96-3.63c1.75-1.12 3.45-2.21 4.66-3.38C17.32 6.61 18 5.44 18 4zm-3.26 10.61c.99.67 1.95 1.39 2.76 2.18C18.93 16.18 20 17.9 20 20v2h-2v-2c0-1.44-.68-2.61-1.88-3.78c-.86-.83-2.01-1.63-3.21-2.42zM7 3h10v1l-.06.5H7.06L7 4zm.68 3h8.64c-.24.34-.52.69-.9 1.06l-.51.44H9.07l-.49-.44c-.38-.37-.66-.72-.9-1.06m1.41 10.5h5.84l.49.44c.38.37.66.72.9 1.06H7.68c.24-.34.52-.69.9-1.06zm-2.03 3h9.88l.06.5v1H7v-1z"})}),Ke=p.forwardRef(Ze),Ye=(s,t)=>e.jsx("svg",{viewBox:"0 0 24 24",width:"1.2em",height:"1.2em",ref:t,...s,children:e.jsx("path",{fill:"currentColor",d:"M19.78 2.2L24 6.42L8.44 22L0 13.55l4.22-4.22l4.22 4.22zm0 2.8L8.44 16.36l-4.22-4.17l-1.41 1.36l5.63 5.62L21.19 6.42z"})}),Je=p.forwardRef(Ye),_e=(s,t)=>e.jsx("svg",{viewBox:"0 0 26 26",width:"1.2em",height:"1.2em",ref:t,...s,children:e.jsx("path",{fill:"currentColor",d:"M24.906 0a1 1 0 0 0-.375.125l-24 13a.99.99 0 0 0 .188 1.813l6.375 1.906c.149 1.179.813 6.285.937 7.281c.124.992.798 1.164 1.469.25c.454-.619 3.124-4.375 3.125-4.375l5.688 5.688a.99.99 0 0 0 1.656-.438l6-24A.99.99 0 0 0 24.906 0M23.47 2.938l-5.032 20.125l-5.656-5.657L21 6L8.219 15.125L3.563 13.75L23.468 2.937z"})}),le=p.forwardRef(_e),Xe=({sequenceEntryStatus:s,metadataDisplayNames:t,approveAccessionVersion:i,deleteAccessionVersion:o,editAccessionVersion:r,clientConfig:a,organism:l,accessToken:d,filesEnabled:n})=>{const[m,u]=p.useState(!1),[g,v]=p.useState(!1),{isLoading:h,data:x}=rs(l,a,d,s),b=Object.entries(x?.processedData.files??{}).length>0,f=s.status!==R;return e.jsxs("div",{className:"px-3 py-2 relative transition-all duration-500",children:[e.jsxs("div",{className:"flex",children:[e.jsxs("div",{className:"flex flex-grow flex-wrap ",children:[e.jsx(is,{status:s.status,dataUseTerms:s.dataUseTerms,accession:s.accession,hasWarnings:s.processingResult===D,hasErrors:s.processingResult===y}),e.jsx(Z,{accessionVersion:C(s),keyName:C(s),value:s.submissionId}),x!==void 0&&e.jsx(es,{data:x,metadataDisplayNames:t,isLoading:h}),s.isRevocation&&e.jsx(Z,{accessionVersion:C(s),keyName:"Revocation entry",value:"This is a revocation entry, which will create a new version that revokes this accession",extraStyle:"text-red-600 font-semibold",disableTruncate:!0})]}),e.jsx(Ee,{sequenceEntryStatus:s,approveAccessionVersion:i,deleteAccessionVersion:o,editAccessionVersion:r,viewSequences:x&&!f?()=>u(!0):void 0,viewFiles:x&&!f?()=>v(!0):void 0,filesEnabled:n,hasFiles:b})]}),x?.errors?.length!==void 0&&x.errors.length>0&&e.jsx(ss,{errors:x.errors,accession:s.accession,metadataDisplayNames:t}),x?.warnings?.length!==void 0&&x.warnings.length>0&&e.jsx(ts,{warnings:x.warnings,accession:s.accession}),e.jsx(De,{isOpen:m,onClose:()=>u(!1),dataToView:x}),e.jsx(Se,{isOpen:g,onClose:()=>v(!1),dataToView:x})]})},Ee=({sequenceEntryStatus:s,approveAccessionVersion:t,deleteAccessionVersion:i,editAccessionVersion:o,viewSequences:r,viewFiles:a,filesEnabled:l,hasFiles:d})=>{const n=g=>`${g?"text-gray-300":"text-gray-500 hover:text-gray-900 hover:cursor-pointer"} inline-block text-xl`,m=s.status===R&&s.processingResult!==y,u=s.status!==R;return e.jsx("div",{className:"flex mb-auto pt-3.5 items-center",children:e.jsxs("div",{className:"flex space-x-4",children:[l&&a&&e.jsxs(e.Fragment,{children:[e.jsx("button",{className:n(!d),onClick:a,"data-tooltip-id":"view-files-tooltip"+s.accession,"data-testid":`view-files-${s.accession}`,disabled:!d,children:e.jsx(Ge,{})},"view-files-button-"+s.accession),e.jsx(j,{id:"view-files-tooltip"+s.accession,content:d?"View files":"No files for this entry"})]}),r&&e.jsxs(e.Fragment,{children:[e.jsx("button",{className:n(!1),onClick:r,"data-tooltip-id":"view-sequences-tooltip"+s.accession,"data-testid":`view-sequences-${s.accession}`,children:e.jsx(Ke,{})},"view-sequences-button-"+s.accession),e.jsx(j,{id:"view-sequences-tooltip"+s.accession,content:"View processed sequences"})]}),e.jsx("div",{className:"mx-3 h-5 mt-0.5 border-l border-gray-300"})," ",e.jsx("button",{className:n(!m),onClick:t,"data-tooltip-id":"approve-tooltip"+s.accession,disabled:!m,children:e.jsx(le,{})},"approve-button-"+s.accession),e.jsx(j,{id:"approve-tooltip"+s.accession,content:m?"Release this sequence entry":s.processingResult===y?"You need to fix the errors before releasing this sequence entry":"Still awaiting preprocessing"}),!s.isRevocation&&e.jsx("button",{className:n(u),"data-testid":`${C({...s})}.edit`,"data-tooltip-id":"edit-tooltip"+s.accession,onClick:o,disabled:u,children:e.jsx(Ve,{})},"edit-button-"+s.accession),e.jsx(j,{id:"edit-tooltip"+s.accession,content:u?"Processing...":"Edit this sequence entry"}),e.jsx("button",{className:n(u),onClick:i,"data-tooltip-id":"delete-tooltip"+s.accession,disabled:u,children:e.jsx($,{})},"delete-button-"+s.accession),e.jsx(j,{id:"delete-tooltip"+s.accession,content:u?"Cannot discard. Wait for preprocessing.":"Discard this sequence entry"})]})})},ie=s=>t=>t.processedFields[0].name===s,es=({data:s,isLoading:t,metadataDisplayNames:i})=>!t&&Object.entries(s.processedData.metadata).map(([o,r],a)=>r===null?null:e.jsx(Z,{accessionVersion:C(s),keyName:i.get(o)??o,value:Le(r),warnings:s.warnings?.filter(ie(o)),errors:s.errors?.filter(ie(o))},a)),ss=({errors:s,accession:t,metadataDisplayNames:i})=>e.jsx("div",{children:e.jsx("div",{className:"flex flex-col m-2 ",children:s.map(o=>{const r=o.processedFields.map(l=>l.type+l.name).join(".")+t,a=o.processedFields.map(l=>i.get(l.name)??l.name).join(", ");return e.jsxs("div",{className:"flex flex-shrink-0",children:[e.jsxs("p",{className:"text-red-600","data-tooltip-id":"error-tooltip-"+t+"-"+r,children:[a,": ",o.message]}),e.jsx(j,{id:"error-tooltip-"+t+"-"+r,content:"You must fix this error before releasing this sequence entry"})]},r)})})}),ts=({warnings:s,accession:t})=>e.jsx("div",{children:e.jsx("div",{className:"flex flex-col m-2 ",children:s.map(i=>{const o=i.processedFields.map(r=>r.name).join(", ");return e.jsxs("p",{className:"text-yellow-500",children:[o,": ",i.message]},i.processedFields.map(r=>r.type+r.name).join(".")+t)})})}),L=({dataUseTerms:s,accession:t})=>{const i=s.type===X?`Under the Restricted Use Terms until ${s.restrictedUntil}`:"To be released as open data";return e.jsxs(e.Fragment,{children:[e.jsx("div",{"data-tooltip-id":"dataUseTerm-tooltip-"+t,children:s.type===X?e.jsx(Pe,{}):e.jsx(Ae,{})}),e.jsx(j,{id:"dataUseTerm-tooltip-"+t,content:i})]})},is=({status:s,dataUseTerms:t,accession:i,hasWarnings:o,hasErrors:r})=>{if(s===F)return e.jsxs("div",{className:"p-2 flex flex-col justify-between",children:[e.jsx("div",{"data-tooltip-id":"awaitingProcessing-tooltip-"+i,children:e.jsx(Qe,{className:"text-gray-500"})},"awaitingProcessing-tooltip-"+i),e.jsx(j,{id:"awaitingProcessing-tooltip-"+i,content:"Awaiting processing"}),e.jsx(L,{dataUseTerms:t,accession:i})]});if(s===R&&r)return e.jsxs("div",{className:"p-2 flex flex-col justify-between",children:[e.jsx("div",{"data-tooltip-id":"error-tooltip-"+i,children:e.jsx(He,{className:"text-red-600"})},"error-tooltip-"+i),e.jsx(j,{id:"error-tooltip-"+i,content:"Error detected"}),e.jsx(L,{dataUseTerms:t,accession:i})]});if(s===P)return e.jsxs("div",{className:"p-2 flex flex-col justify-between",children:[e.jsx("div",{"data-tooltip-id":"inProcessing-tooltip-"+i,children:e.jsx("span",{className:"loading loading-spinner loading-sm"})},"inProcessing-tooltip-"+i),e.jsx(j,{id:"inProcessing-tooltip-"+i,content:"In processing"}),e.jsx(L,{dataUseTerms:t,accession:i})]});if(s===R&&!r)return e.jsxs("div",{className:"p-2 flex flex-col justify-between",children:[e.jsx("div",{"data-tooltip-id":"awaitingApproval-tooltip-"+i,children:e.jsx(Je,{className:o?"text-yellow-400":"text-green-500"})}),e.jsx(j,{id:"awaitingApproval-tooltip-"+i,content:o?"Passed QC with warnings":"Passed QC"}),e.jsx(L,{dataUseTerms:t,accession:i})]})},Z=({accessionVersion:s,keyName:t,value:i,extraStyle:o,keyStyle:r,warnings:a,errors:l,disableTruncate:d=!1})=>{const{textColor:n,primaryMessages:m,secondaryMessages:u}=os(l,a),g="text-tooltip-"+t+s,v="note-tooltip-"+t+s,h=p.useRef(null),[x,b]=p.useState(!1);p.useEffect(()=>{h.current&&!d?b(h.current.scrollWidth>h.current.clientWidth):b(!1)},[i,d]);const f=m!==void 0||x,B=m!==void 0?m.map(A=>A.message).join(", "):i;return e.jsxs("div",{className:"flex flex-col m-2 ",children:[e.jsx("span",{className:r??"text-gray-500 uppercase text-xs",children:t}),e.jsxs("span",{className:`text-base ${o}`,children:[e.jsx("span",{ref:h,className:`${n} ${d?"":"truncate max-w-xs inline-block"}`,"data-tooltip-id":f?g:void 0,children:i}),f&&e.jsx(j,{id:g,content:B}),u!==void 0&&e.jsxs(e.Fragment,{children:[e.jsx(Be,{className:"text-yellow-500 inline-block","data-tooltip-id":v}),e.jsx(j,{id:v,content:u.map(A=>A.message).join(", ")})]})]})]})};function os(s,t){const i=s!==void 0&&s.length>0,o=t!==void 0&&t.length>0;return i?{textColor:"text-red-600",primaryMessages:s,secondaryMessages:o?t:void 0}:o?{textColor:"text-yellow-500",primaryMessages:t,secondaryMessages:void 0}:{textColor:"",primaryMessages:void 0,secondaryMessages:void 0}}function rs(s,t,i,o){const{status:r,accession:a,version:l,isRevocation:d}=o;return ae(t).useGetDataToEdit({headers:V(i),params:{organism:s,accession:a,version:l}},{enabled:r!==F&&r!==P&&!d})}function ns(s,t,i,o,r,a){const l=p.useMemo(()=>ae(i),[i]),d=[F,P,R],n=[T,D,y],[m,u]=p.useState(d),[g,v]=p.useState(n),h=l.useGetSequences({headers:V(o),params:{organism:s},queries:{groupIdsFilter:t.groupId.toString(),initialStatusesFilter:d.join(","),statusesFilter:m.join(","),processingResultFilter:g.join(","),page:a.pageOneIndexed-1,size:a.size}},{onError:f=>r(cs(f)),refetchInterval:2e3});h.error&&r("Failed to query Group");const x=l.useDeleteSequences({headers:V(o),params:{organism:s}},{onSuccess:()=>h.refetch(),onError:f=>r(as(f))}),b=l.useApproveProcessedData({headers:V(o),params:{organism:s}},{onSuccess:()=>h.refetch(),onError:f=>r(ls(f))});return{deleteSequenceEntries:x.mutate,approveProcessedData:b.mutate,getSequences:h,includedStatuses:m,setIncludedStatuses:u,includedProcessingResults:g,setIncludedProcessingResults:v}}function as(s){return Y(K,"deleteSequences",s)?"Failed to delete sequence entries: "+s.response.data.detail:"Failed to delete sequence entries: "+J(s)}function ls(s){return Y(K,"approveProcessedData",s)?"Failed to approve processed sequence entries: "+s.response.data.detail:"Failed to approve processed sequence entries: "+J(s)}function cs(s){return Y(K,"getSequences",s)?"Failed to query sequences: "+s.response.data.detail:"Failed to query sequences: "+J(s)}const ds=(s,t)=>e.jsx("svg",{viewBox:"0 0 24 24",width:"1.2em",height:"1.2em",ref:t,...s,children:e.jsx("path",{fill:"none",stroke:"currentColor",strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M22 3H2l8 9.46V19l4 2v-8.54z"})}),xs=p.forwardRef(ds),oe=`group flex rounded-md items-center w-full px-2 py-2 text-sm
hover:bg-primary-500 bg-primary-600 text-white text-left mb-1`;let G=null;const re=[10,20,50,100],q=({text:s,countNumber:t,setVisibility:i,visibilityEnabled:o})=>e.jsx("div",{className:"flex items-center gap-3 text-sm text-gray-700 px-3",children:e.jsxs("label",{children:[e.jsx("input",{type:"checkbox",checked:o,onChange:()=>i(!o),className:"mr-2 text-gray-400"}),e.jsxs("span",{className:" inline-block font-semibold ",children:[t," "]})," ",s]})}),ps=({clientConfig:s,organism:t,group:i,accessToken:o,metadataDisplayNames:r,filesEnabled:a})=>{const[l,d]=p.useState({pageOneIndexed:1,size:re[2]}),n=ns(t,i,s,o,fe.error,l),m=n.includedProcessingResults.includes(T),u=n.includedProcessingResults.includes(D),g=n.includedProcessingResults.includes(y),v=n.includedStatuses.includes(P)&&n.includedStatuses.includes(F),h=(c,N)=>{n.setIncludedStatuses(k=>N?[...k,c]:k.filter(U=>U!==c))},x=(c,N)=>{n.setIncludedProcessingResults(k=>N?[...k,c]:k.filter(U=>U!==c))},b=c=>x(T,c),f=c=>x(D,c),B=c=>x(y,c),A=c=>{h(P,c),h(F,c)},ce=c=>{const N=parseInt(c.target.value,10);d({pageOneIndexed:1,size:N})};let w=n.getSequences.data;if(!n.getSequences.isLoading&&!n.getSequences.isError&&(G=n.getSequences.data),n.getSequences.isLoading)if(G)w=G;else return e.jsx("div",{children:"Loading..."});if(n.getSequences.isError)return e.jsxs("div",{children:["Error: ",n.getSequences.error.message]});if(w===void 0)return e.jsx("div",{children:"Loading.."});const de=w.statusCounts[F],xe=w.statusCounts[P],z=de+xe,I=w.statusCounts[R],_=I+z,M=w.processingResultCounts[y],O=w.processingResultCounts[D],H=w.processingResultCounts[T],W=O+H,Q=(v?z:0)+(m?H:0)+(u?O:0)+(g?M:0);if((l.pageOneIndexed-1)*l.size>Q&&d({...l,pageOneIndexed:Math.ceil(Q/l.size)}),_===0)return e.jsxs("div",{className:"pt-1 text-gray-600",children:["You do not currently have any unreleased sequences awaiting review. You can view your released sequences on the"," ",e.jsx("a",{href:te.mySequencesPage(t,i.groupId),className:"text-primary-600 hover:underline",children:"Released sequences"})," ","page."]});const pe=w.sequenceEntries,ue=e.jsxs("div",{className:"flex flex-col","data-testid":"review-page-control-panel",children:[e.jsxs("div",{className:"text-gray-600 mr-3",children:[z>0&&e.jsx("span",{className:"loading loading-spinner loading-sm mr-2 relative top-1",children:" "}),I," of ",_," sequences processed"]}),e.jsxs("div",{className:"border border-slate-200 p-3 mt-3 flex items-start",children:[e.jsx(xs,{className:"w-4 h-4 inline-block text-gray-500 mt-1 mr-3"}),e.jsx(q,{text:"awaiting processing",countNumber:z,setVisibility:A,visibilityEnabled:v},"unprocessed"),e.jsx("div",{className:"border-green-500 border-b-2 pb-1",children:e.jsx(q,{text:"no issues",countNumber:H,setVisibility:b,visibilityEnabled:m},"valid")}),e.jsx("div",{className:"border-yellow-400 border-b-2 pb-1",children:e.jsx(q,{text:"with warnings",countNumber:O,setVisibility:f,visibilityEnabled:u},"warnings")}),e.jsx("div",{className:"border-b-2 border-red-600 pb-1",children:e.jsx(q,{text:"with errors",countNumber:M,setVisibility:B,visibilityEnabled:g},"errors")})]})]}),me=e.jsxs("div",{className:"flex justify-end align-center gap-3 py-3",children:[e.jsx(ke,{count:Math.ceil(Q/l.size),page:l.pageOneIndexed,onChange:(c,N)=>{d({...l,pageOneIndexed:N})},color:"primary",variant:"outlined",shape:"rounded"}),e.jsxs("div",{children:[e.jsx("label",{htmlFor:"pageSize",children:"Page size: "}),e.jsx("select",{id:"pageSize",value:l.size,onChange:ce,children:re.map(c=>e.jsx("option",{value:c,children:c},c))})]})]}),he=e.jsxs("div",{className:"flex justify-end items-center gap-3 mt-auto ",children:[I>0&&e.jsxs(ye,{as:"div",className:" inline-block text-left",children:[e.jsxs(Ce,{className:"border rounded-md p-1 bg-primary-600 text-white px-2",children:[e.jsx($,{className:"inline-block w-4 h-4 -mt-0.5 mr-1.5"}),"Discard sequences",e.jsx(Me,{className:"inline-block ml-1 w-3 h-3 -mt-0.5"})]}),e.jsx(Re,{className:"origin-top-right absolute z-50 bg-white",children:e.jsxs("div",{className:"py-1",children:[M>0&&g&&e.jsx(se,{children:e.jsxs("button",{className:oe,onClick:()=>S({dialogText:"Are you sure you want to discard all sequences with errors?",confirmButtonText:"Discard",onConfirmation:()=>{n.deleteSequenceEntries({groupIdsFilter:[i.groupId],scope:je.value})}}),children:[e.jsx($,{className:"inline-block w-4 h-4 -mt-0.5 mr-1.5"}),"Discard ",M," sequence",M>1?"s":""," with errors"]})}),e.jsx(se,{children:e.jsxs("button",{className:oe,onClick:()=>S({dialogText:`Are you sure you want to discard all ${I} processed sequences?`,confirmButtonText:"Discard",onConfirmation:()=>{n.deleteSequenceEntries({groupIdsFilter:[i.groupId],scope:E.value})}}),children:[e.jsx($,{className:"inline-block w-4 h-4 -mt-0.5 mr-1.5"}),"Discard all ",I," processed sequences"]})})]})})]}),W>0&&e.jsxs("button",{className:"border rounded-md p-1 bg-primary-600 text-white px-2",onClick:()=>S({dialogText:"Are you sure you want to release all valid sequences?",confirmButtonText:"Release",onConfirmation:()=>{n.approveProcessedData({groupIdsFilter:[i.groupId],scope:ee.value}),ne(t)}}),children:[e.jsx(le,{className:"inline-block w-4 h-4 -mt-0.5 mr-1.5"}),"Release ",W," valid sequence",W>1?"s":""]})]}),ge=e.jsx("div",{className:"flex flex-col gap-2 py-4 divide-y divide-gray-200",children:pe.map(c=>e.jsx("div",{children:e.jsx(Xe,{sequenceEntryStatus:c,metadataDisplayNames:r,approveAccessionVersion:()=>S({dialogText:`Are you sure you want to approve ${C(c)}?`,confirmButtonText:"Approve",onConfirmation:()=>{n.approveProcessedData({accessionVersionsFilter:[c],groupIdsFilter:[i.groupId],scope:ee.value}),ne(t)}}),deleteAccessionVersion:()=>S({dialogText:`Are you sure you want to discard ${C(c)}?`,confirmButtonText:"Discard",onConfirmation:()=>{n.deleteSequenceEntries({accessionVersionsFilter:[c],groupIdsFilter:[i.groupId],scope:E.value})}}),editAccessionVersion:()=>{window.location.href=te.editPage(t,c)},clientConfig:s,organism:t,accessToken:o,filesEnabled:a})},c.accession))});return e.jsxs("div",{className:n.getSequences.isLoading?"opacity-50 pointer-events-none":"",children:[e.jsxs("div",{className:"sticky top-0 z-10",children:[e.jsxs("div",{className:"flex sm:justify-between items-bottom flex-col md:flex-row gap-5 bg-white pb-1",children:[ue,he]}),e.jsx("div",{className:"h-2 w-full",style:{background:"linear-gradient(0deg, rgba(255, 255, 255, 0) 0%,rgba(100, 100, 100, .2) 80%)"}})]}),ge,me]})},ne=s=>{const t=Math.floor(Date.now()/1e3);localStorage.setItem(Fe(s),t.toString())},Bs=Ie(ps);export{Bs as ReviewPage};
