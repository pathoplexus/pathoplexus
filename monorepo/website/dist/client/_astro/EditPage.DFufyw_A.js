import{j as s}from"./jsx-runtime.C9E4cUVc.js";import{r as b}from"./index.BOC3FD3Q.js";import{y as f}from"./_astro-entry_react-toastify.w1t6keWD.js";import{E as F,a as I,S as C,b as M,M as P,c as L}from"./SequencesForm.CPpvmeJc.js";import{g as E}from"./clientLogger.CHIvnBnE.js";import{g as m,r as S}from"./routes.B4evqrXf.js";import{b as x}from"./serviceHooks.qDjWrls6.js";import{a as $}from"./lapis.BMBLPoxt.js";import"./config.CimgolCL.js";import{c as v}from"./createAuthorizationHeader.D0lXW5f5.js";import{d as A}from"./ConfirmationDialog.DES7BW3S.js";import{w as O}from"./withQueryProvider.C5jGp74p.js";import"./clsx.B-dksMZM.js";import"./index.D4-OCOkl.js";import"./DisabledUntilHydrated.BWqRU456.js";import"./isClient.CwQyaCl4.js";import"./open-closed.CJcKiZsm.js";import"./index.B7uol7Hd.js";import"./index.CExoqQxK.js";import"./index.BDobkqVR.js";import"./baseline-download.BIAEx4Am.js";import"./info-outline.Ba8IpcSU.js";import"./react-tooltip.min.CEnrnmjl.js";import"./settings.CpUHmJUd.js";import"./SubmissionRoute.C0UznQB_.js";import"./index.B4z6aONy.js";import"./client.DPyJZckk.js";const u=E("EditPage"),k=({organism:t,dataToEdit:e,segmentNames:n,clientConfig:i,accessToken:r,groupedInputFields:c,submissionDataTypes:o})=>{const[l,h]=b.useState(F.fromInitialData(e)),[d,j]=b.useState(I.fromInitialData(e,n)),g=e.status===$,{mutate:y,isLoading:q}=H(t,i,r,e,a=>f.error(a,{position:"top-center",autoClose:!1})),{mutate:R,isLoading:w}=J(t,i,r,e,a=>f.error(a,{position:"top-center",autoClose:!1})),N=()=>{const a=l.getMetadataTsv(e.submissionId,e.accession);if(a===void 0){f.error("Please enter metadata.",{position:"top-center",autoClose:!1});return}g?y({metadataFile:a,sequenceFile:o.consensusSequences?d.getSequenceFasta(e.submissionId):void 0}):R({accession:e.accession,version:e.version,data:{metadata:l.getMetadataRecord(),unalignedNucleotideSequences:d.getSequenceRecord()}})},p=q||w;return s.jsxs(s.Fragment,{children:[s.jsx("div",{className:"flex items-center mb-4",children:s.jsxs("h1",{className:"title",children:[g?"Create new revision from":"Edit"," ",e.accession,".",e.version]})}),s.jsx("table",{className:"customTable",children:s.jsxs("tbody",{className:"w-full",children:[s.jsx(C,{title:"Original data",bold:!0}),s.jsx(M,{submissionId:e.submissionId}),s.jsx(P,{editableMetadata:l,setEditableMetadata:h,groupedInputFields:c})]})}),o.consensusSequences&&s.jsx("div",{className:"mt-4 space-y-4",children:s.jsx(L,{editableSequences:d,setEditableSequences:j,dataToEdit:e,isLoading:p})}),s.jsx("div",{className:"flex items-center gap-4 mt-4",children:s.jsxs("button",{className:"btn normal-case",onClick:()=>A({dialogText:"Do you really want to submit?",onConfirmation:N}),disabled:p,children:[p&&s.jsx("span",{className:"loading loading-spinner loading-sm mr-2"}),"Submit"]})})]})},pe=O(k);function H(t,e,n,i,r){return x(e).useRevise({params:{organism:t},headers:v(n)},{onSuccess:async()=>{await u.info("Successfully submitted revision for "+m(i)),location.href=S.userSequenceReviewPage(t,i.groupId)},onError:async c=>{const o=`Failed to submit revision for ${m(i)} with error '${JSON.stringify(c)})}'`;await u.info(o),r(o)}})}function J(t,e,n,i,r){return x(e).useSubmitReviewedSequence({headers:v(n),params:{organism:t}},{onSuccess:async()=>{await u.info("Successfully submitted edited data "+m(i)),location.href=S.userSequenceReviewPage(t,i.groupId)},onError:async c=>{const o=`Failed to submit edited data for ${m(i)} with error '${JSON.stringify(c)})}'`;await u.info(o),r(o)}})}export{pe as EditPage};
